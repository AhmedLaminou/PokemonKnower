{% extends "base.html" %}

{% block title %}Gallery | Pokémon Knower{% endblock %}

{% block content %}
<div class="gallery-page">
    <div class="page-header">
        <h1><i class="fas fa-images"></i> Pokémon Gallery</h1>
        <p>Browse all Pokémon in a beautiful visual grid</p>
    </div>

    <!-- Filters -->
    <div class="gallery-filters">
        <div class="filter-group">
            <label>Generation</label>
            <select id="genFilter" onchange="applyFilters()">
                <option value="">All Generations</option>
                <option value="1" {% if current_gen == '1' %}selected{% endif %}>Gen 1 (Kanto)</option>
                <option value="2" {% if current_gen == '2' %}selected{% endif %}>Gen 2 (Johto)</option>
                <option value="3" {% if current_gen == '3' %}selected{% endif %}>Gen 3 (Hoenn)</option>
                <option value="4" {% if current_gen == '4' %}selected{% endif %}>Gen 4 (Sinnoh)</option>
                <option value="5" {% if current_gen == '5' %}selected{% endif %}>Gen 5 (Unova)</option>
                <option value="6" {% if current_gen == '6' %}selected{% endif %}>Gen 6 (Kalos)</option>
                <option value="7" {% if current_gen == '7' %}selected{% endif %}>Gen 7 (Alola)</option>
                <option value="8" {% if current_gen == '8' %}selected{% endif %}>Gen 8 (Galar)</option>
                <option value="9" {% if current_gen == '9' %}selected{% endif %}>Gen 9 (Paldea)</option>
            </select>
        </div>

        <div class="filter-group">
            <label>Type</label>
            <select id="typeFilter" onchange="applyFilters()">
                <option value="">All Types</option>
                {% for type_name in types.keys() %}
                <option value="{{ type_name }}" {% if current_type == type_name %}selected{% endif %}>{{ type_name|capitalize }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="filter-group">
            <label>Display</label>
            <div class="view-toggle">
                <button class="view-btn active" data-view="grid" onclick="setView('grid')">
                    <i class="fas fa-th"></i>
                </button>
                <button class="view-btn" data-view="list" onclick="setView('list')">
                    <i class="fas fa-list"></i>
                </button>
            </div>
        </div>

        <div class="filter-stats">
            <span>{{ pokemon_list|length }} Pokémon</span>
        </div>
    </div>

    <!-- Gallery Grid -->
    <div class="gallery-grid" id="galleryGrid">
        {% for pokemon in pokemon_list %}
        <a href="{{ url_for('pokemon_detail', identifier=pokemon.name) }}" class="gallery-item" data-type="{{ pokemon.main_type|lower }}">
            <div class="gallery-image">
                <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/{{ pokemon.number }}.png" 
                     alt="{{ pokemon.name }}"
                     loading="lazy"
                     onerror="this.src='/static/images/pokeball.png'">
            </div>
            <div class="gallery-info">
                <span class="gallery-number">#{{ '%03d' % pokemon.number }}</span>
                <span class="gallery-name">{{ pokemon.name }}</span>
                <div class="gallery-types">
                    <span class="type-dot {{ pokemon.main_type|lower }}"></span>
                    {% if pokemon.secondary_type %}
                    <span class="type-dot {{ pokemon.secondary_type|lower }}"></span>
                    {% endif %}
                </div>
            </div>
        </a>
        {% endfor %}
    </div>

    {% if not pokemon_list %}
    <div class="empty-gallery">
        <i class="fas fa-search"></i>
        <p>No Pokémon found matching your filters</p>
        <button class="btn btn-secondary" onclick="clearFilters()">Clear Filters</button>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_css %}
<style>
    .gallery-page {
        max-width: 1600px;
        margin: 0 auto;
        padding: 2rem;
    }

    .page-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .page-header h1 i {
        color: var(--pokemon-yellow);
    }

    .gallery-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        align-items: flex-end;
        background: var(--bg-card);
        padding: 1rem 1.5rem;
        border-radius: var(--radius-lg);
        margin-bottom: 2rem;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .filter-group label {
        font-size: 0.85rem;
        color: var(--text-muted);
    }

    .filter-group select {
        padding: 0.5rem 1rem;
        background: var(--bg-darker);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        color: var(--text-primary);
        min-width: 150px;
    }

    .view-toggle {
        display: flex;
        gap: 0.25rem;
    }

    .view-btn {
        padding: 0.5rem 0.75rem;
        background: var(--bg-darker);
        border: 1px solid var(--border-color);
        color: var(--text-muted);
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .view-btn:first-child { border-radius: var(--radius-sm) 0 0 var(--radius-sm); }
    .view-btn:last-child { border-radius: 0 var(--radius-sm) var(--radius-sm) 0; }

    .view-btn.active {
        background: var(--pokemon-red);
        border-color: var(--pokemon-red);
        color: white;
    }

    .filter-stats {
        margin-left: auto;
        color: var(--text-secondary);
        font-weight: 600;
    }

    .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 1rem;
    }

    .gallery-grid.list-view {
        grid-template-columns: 1fr;
    }

    .gallery-item {
        background: var(--bg-card);
        border-radius: var(--radius-md);
        overflow: hidden;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .gallery-item:hover {
        transform: translateY(-4px) scale(1.02);
        box-shadow: var(--shadow-md);
    }

    .gallery-image {
        aspect-ratio: 1;
        background: linear-gradient(135deg, var(--bg-darker), var(--bg-card));
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.5rem;
    }

    .gallery-image img {
        width: 80%;
        height: 80%;
        object-fit: contain;
        transition: transform 0.3s ease;
    }

    .gallery-item:hover .gallery-image img {
        transform: scale(1.1);
    }

    .gallery-info {
        padding: 0.75rem;
        text-align: center;
    }

    .gallery-number {
        display: block;
        font-size: 0.7rem;
        color: var(--text-muted);
    }

    .gallery-name {
        display: block;
        font-weight: 600;
        font-size: 0.85rem;
        margin: 0.25rem 0;
        color: var(--text-primary);
    }

    .gallery-types {
        display: flex;
        justify-content: center;
        gap: 0.25rem;
    }

    .type-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
    }

    .type-dot.normal { background: var(--type-normal); }
    .type-dot.fire { background: var(--type-fire); }
    .type-dot.water { background: var(--type-water); }
    .type-dot.electric { background: var(--type-electric); }
    .type-dot.grass { background: var(--type-grass); }
    .type-dot.ice { background: var(--type-ice); }
    .type-dot.fighting { background: var(--type-fighting); }
    .type-dot.poison { background: var(--type-poison); }
    .type-dot.ground { background: var(--type-ground); }
    .type-dot.flying { background: var(--type-flying); }
    .type-dot.psychic { background: var(--type-psychic); }
    .type-dot.bug { background: var(--type-bug); }
    .type-dot.rock { background: var(--type-rock); }
    .type-dot.ghost { background: var(--type-ghost); }
    .type-dot.dragon { background: var(--type-dragon); }
    .type-dot.dark { background: var(--type-dark); }
    .type-dot.steel { background: var(--type-steel); }
    .type-dot.fairy { background: var(--type-fairy); }

    /* List View */
    .gallery-grid.list-view .gallery-item {
        display: flex;
        align-items: center;
    }

    .gallery-grid.list-view .gallery-image {
        width: 80px;
        height: 80px;
        flex-shrink: 0;
    }

    .gallery-grid.list-view .gallery-info {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 1rem;
        text-align: left;
    }

    .gallery-grid.list-view .gallery-name {
        font-size: 1rem;
    }

    .empty-gallery {
        text-align: center;
        padding: 4rem;
        color: var(--text-muted);
    }

    .empty-gallery i {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.3;
    }

    @media (max-width: 768px) {
        .gallery-filters {
            flex-direction: column;
            align-items: stretch;
        }

        .filter-stats {
            margin-left: 0;
            text-align: center;
        }

        .gallery-grid {
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
function applyFilters() {
    const gen = document.getElementById('genFilter').value;
    const type = document.getElementById('typeFilter').value;
    
    const params = new URLSearchParams();
    if (gen) params.append('gen', gen);
    if (type) params.append('type', type);
    
    window.location.href = '/gallery' + (params.toString() ? '?' + params.toString() : '');
}

function clearFilters() {
    window.location.href = '/gallery';
}

function setView(view) {
    document.querySelectorAll('.view-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.view === view);
    });
    
    const grid = document.getElementById('galleryGrid');
    grid.classList.toggle('list-view', view === 'list');
    
    localStorage.setItem('galleryView', view);
}

// Restore view preference
document.addEventListener('DOMContentLoaded', () => {
    const savedView = localStorage.getItem('galleryView');
    if (savedView) {
        setView(savedView);
    }
});
</script>
{% endblock %}
